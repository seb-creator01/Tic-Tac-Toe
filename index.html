<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Tic-Tac-Toe Pro</title>
  <style>
    /* ðŸŽ¨ Design Customization for smooth, attractive colors and depth */
    :root {
      --primary-color: #2c3e50; /* Dark Blue/Charcoal */
      --secondary-color: #3498db; /* Bright Blue */
      --accent-color: #e74c3c; /* Red/Mute */
      --win-color: #27ae60; /* Emerald Green */
      --cell-bg: #ecf0f1; /* Light Gray/Silver */
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      /* Smooth radial gradient */
      background: radial-gradient(circle at top left, var(--secondary-color) 0%, var(--primary-color) 100%);
      text-align: center;
      color: white;
      margin: 0;
      padding: 20px;
      min-height: 100vh;
    }
    h1 {
      margin-bottom: 15px;
      letter-spacing: 2px;
      font-weight: 300;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
    }
    #controls {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      margin-bottom: 20px;
    }
    #board-area {
      display: flex;
      justify-content: center;
      gap: 50px;
      margin-top: 30px;
    }
    #board {
      display: grid;
      grid-template-columns: repeat(3, 100px);
      gap: 7px; /* Slightly larger gap */
      justify-content: center;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5); /* Board shadow */
      border-radius: 10px;
      padding: 10px;
      background: rgba(255, 255, 255, 0.1); /* Slight transparency */
    }
    .cell {
      width: 100px;
      height: 100px;
      background: var(--cell-bg);
      color: var(--primary-color);
      font-size: 3em; /* Larger X/O */
      font-weight: bold;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      border-radius: 8px;
      transition: background 0.2s, transform 0.1s, box-shadow 0.2s;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    .cell:hover {
      background: #bdc3c7;
      transform: translateY(-2px);
      box-shadow: 0 6px 10px rgba(0, 0, 0, 0.2);
    }
    .cell.win {
      background: var(--win-color);
      color: white;
      animation: win-pulse 0.5s infinite alternate;
    }
    @keyframes win-pulse {
      from { transform: scale(1); box-shadow: 0 0 15px var(--win-color); }
      to { transform: scale(1.05); box-shadow: 0 0 25px var(--win-color); }
    }
    .btn-group {
      margin: 5px 0;
    }
    .btn {
      padding: 10px 20px;
      margin: 5px;
      font-size: 1em;
      cursor: pointer;
      border: none;
      border-radius: 25px; /* Pill shape */
      background: var(--secondary-color);
      color: white;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
      transition: background 0.3s, transform 0.1s;
    }
    .btn:hover {
      background: #2980b9;
      transform: translateY(-1px);
    }
    .btn:active {
      transform: translateY(1px);
    }
    .btn.active-mode {
      background: var(--win-color);
    }
    #score {
      margin: 15px 0;
      font-size: 1.2em;
      font-weight: bold;
      letter-spacing: 1px;
    }
    #muteBtn {
      position: absolute;
      top: 20px;
      right: 20px;
      background: var(--accent-color);
      box-shadow: none;
      border-radius: 5px;
    }
    #muteBtn:hover {
      background: #c0392b;
    }
    footer {
      margin-top: 40px;
      font-size: 0.9em;
      opacity: 0.7;
    }

    /* ðŸ’¬ Chat Box Styles (Placeholder) */
    #chat-box {
        width: 300px;
        height: 450px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        padding: 15px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        display: none; /* Hide by default, only for online mode */
    }
    #chat-messages {
        flex-grow: 1;
        overflow-y: auto;
        padding-right: 10px;
        margin-bottom: 10px;
        font-size: 0.9em;
    }
    #chat-input-container {
        display: flex;
        gap: 5px;
    }
    #chat-input {
        flex-grow: 1;
        padding: 8px;
        border: none;
        border-radius: 5px;
        background: rgba(255, 255, 255, 0.9);
        color: var(--primary-color);
    }
    #chat-send-btn {
        padding: 8px 15px;
        background: var(--win-color);
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
    }
    .chat-message-you {
      text-align: right;
      color: #79df89;
    }
    .chat-message-other {
      text-align: left;
      color: white;
    }

  </style>
</head>
<body>
  <h1>Tic-Tac-Toe Pro</h1>
  <div id="score">X: 0 | O: 0</div>

  <div id="controls">
    <div class="btn-group">
        <button class="btn active-mode" id="pvpBtn" onclick="startGame('pvp')">Play with Friend</button>
        <button class="btn" id="aiBtn" onclick="startGame('ai')">Play vs AI</button>
        <button class="btn" id="onlineBtn" onclick="startGame('online')">Online Multiplayer</button>
    </div>

    <div id="difficulty-group" class="btn-group" style="display: none;">
        <span style="margin-right: 10px;">AI Difficulty:</span>
        <button class="btn difficulty-btn active-mode" onclick="setDifficulty('easy')">Easy</button>
        <button class="btn difficulty-btn" onclick="setDifficulty('normal')">Normal</button>
        <button class="btn difficulty-btn" onclick="setDifficulty('hard')">Hard</button>
    </div>
  </div>

  <button class="btn" id="muteBtn" onclick="toggleMusic()">Mute</button>
  
  <div id="board-area">
    <div id="board"></div>
    
    <div id="chat-box">
      <div id="chat-messages">
        <p class="chat-message-you">You: Hey, good luck!</p>
        <p class="chat-message-other">Opponent: You too, let's play!</p>
      </div>
      <div id="chat-input-container">
        <input type="text" id="chat-input" placeholder="Type a message..." />
        <button id="chat-send-btn">Send</button>
      </div>
    </div>
  </div>

  <footer>Developed by Seb-Creations (Enhanced for difficulty and design)</footer>

  <audio id="bgMusic" loop>
    <source src="https://assets.mixkit.co/sfx/preview/mixkit-game-music-778.mp3" type="audio/mp3">
  </audio>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    // ** ðŸ” Firebase Setup (Keep confidential keys safe in production!) **
    const firebaseConfig = {
      // NOTE: Using the provided API key structure.
      apiKey: "AIzaSyAFUoT40IjaiqH2791QvyNUP6SakHarupY",
      authDomain: "tic-tac-toe-9e69d.firebaseapp.com",
      databaseURL: "https://tic-tac-toe-9e69d-default-rtdb.firebaseio.com/",
      projectId: "tic-tac-toe-9e69d",
      storageBucket: "tic-tac-toe-9e69d.appspot.com",
      messagingSenderId: "279666476240",
      appId: "1:279666476240:web:106c4481fbda677424cad5",
      measurementId: "G-WQV8NJN397"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const boardEl = document.getElementById('board');
    const scoreEl = document.getElementById('score');
    const bgMusic = document.getElementById('bgMusic');
    const chatBoxEl = document.getElementById('chat-box');
    const difficultyGroupEl = document.getElementById('difficulty-group');
    
    let currentPlayer = 'X';
    let board = Array(9).fill('');
    let mode = 'pvp'; // 'pvp', 'ai', 'online'
    let currentDifficulty = 'easy'; // 'easy', 'normal', 'hard'
    let score = { X: 0, O: 0 };
    
    // --- Win Conditions
    const WINNING_COMBOS = [
      [0,1,2], [3,4,5], [6,7,8],
      [0,3,6], [1,4,7], [2,5,8],
      [0,4,8], [2,4,6]
    ];


    // --- ðŸŽ® Core Game Functions ---

    function drawBoard() {
      boardEl.innerHTML = '';
      board.forEach((cell, i) => {
        const div = document.createElement('div');
        div.className = 'cell';
        div.innerText = cell;
        // Disable clicks if it's AI's turn or not the player's turn in online mode
        const isClickable = !board[i] && !(mode === 'ai' && currentPlayer === 'O');
        if (isClickable) {
          div.onclick = () => handleMove(i);
        } else {
          div.style.cursor = 'default';
        }
        boardEl.appendChild(div);
      });
    }

    function handleMove(index) {
      if (board[index] || (mode === 'ai' && currentPlayer === 'O')) return;

      board[index] = currentPlayer;
      updateBoard();
      
      const winnerCombo = checkWin();
      if (winnerCombo) {
        // Apply win class to winning cells
        winnerCombo.forEach(i => document.querySelectorAll('.cell')[i].classList.add('win'));
        
        score[currentPlayer]++;
        setTimeout(() => {
          alert(`${currentPlayer} wins!`);
          resetBoard();
        }, 100);
      } else if (board.every(cell => cell)) {
        setTimeout(() => {
          alert("Draw!");
          resetBoard();
        }, 100);
      } else {
        currentPlayer = currentPlayer === 'X' ? 'O' : 'X';
        if (mode === 'ai' && currentPlayer === 'O') {
          setTimeout(aiMove, 500);
        }
      }
    }

    function checkWin(checkBoard = board) {
      for (const combo of WINNING_COMBOS) {
        const [a, b, c] = combo;
        if (checkBoard[a] && checkBoard[a] === checkBoard[b] && checkBoard[a] === checkBoard[c]) {
          return combo; // Return the winning combination array
        }
      }
      return null; // No win
    }

    function resetBoard() {
      board = Array(9).fill('');
      currentPlayer = 'X';
      drawBoard();
      scoreEl.textContent = `X: ${score.X} | O: ${score.O}`;
      
      // Update online state if needed
      if (mode === 'online') {
        const gameRef = ref(db, 'games/game1');
        set(gameRef, { board: board, currentPlayer: 'X' });
      }
    }


    // --- ðŸ’» AI Logic (Difficulty Levels) ---

    function aiMove() {
      let move = -1;
      
      if (currentDifficulty === 'hard') {
        move = findBestMove(board, currentPlayer).index;
      } else if (currentDifficulty === 'normal') {
        move = normalAIMove(board, 'O');
      } else { // 'easy'
        move = easyAIMove(board);
      }
      
      if (move !== -1) {
        handleMove(move);
      }
    }
    
    function easyAIMove(currentBoard) {
      // **EASY**: Purely random move
      const empty = currentBoard.map((v, i) => v === '' ? i : null).filter(v => v !== null);
      return empty[Math.floor(Math.random() * empty.length)];
    }
    
    function normalAIMove(currentBoard, player) {
      const opponent = player === 'X' ? 'O' : 'X';
      const empty = currentBoard.map((v, i) => v === '' ? i : null).filter(v => v !== null);
      
      // 1. Check for a winning move for 'O'
      for (const i of empty) {
        let tempBoard = [...currentBoard];
        tempBoard[i] = player;
        if (checkWin(tempBoard)) return i;
      }
      
      // 2. Check for an immediate losing move (block 'X')
      for (const i of empty) {
        let tempBoard = [...currentBoard];
        tempBoard[i] = opponent;
        if (checkWin(tempBoard)) return i;
      }
      
      // 3. Take the center (if available)
      if (currentBoard[4] === '') return 4;
      
      // 4. Take a random corner
      const corners = [0, 2, 6, 8].filter(i => currentBoard[i] === '');
      if (corners.length > 0) return corners[Math.floor(Math.random() * corners.length)];
      
      // 5. Fallback: Random move
      return easyAIMove(currentBoard);
    }
    
    // Minimax Implementation for **HARD** difficulty (Unbeatable)
    function findBestMove(currentBoard, player) {
      const availableSpots = currentBoard.map((v, i) => v === '' ? i : null).filter(v => v !== null);

      if (checkWin(currentBoard) && checkWin(currentBoard).length === 3 && currentBoard[checkWin(currentBoard)[0]] === 'X') return { score: -10 };
      if (checkWin(currentBoard) && checkWin(currentBoard).length === 3 && currentBoard[checkWin(currentBoard)[0]] === 'O') return { score: 10 };
      if (availableSpots.length === 0) return { score: 0 };
      
      let bestMove = { index: -1, score: player === 'O' ? -Infinity : Infinity };
      
      for (let i = 0; i < availableSpots.length; i++) {
        const spot = availableSpots[i];
        currentBoard[spot] = player;
        
        const result = findBestMove(currentBoard, player === 'O' ? 'X' : 'O');
        
        currentBoard[spot] = ''; // Reset the spot
        
        if (player === 'O') {
          if (result.score > bestMove.score) {
            bestMove.score = result.score;
            bestMove.index = spot;
          }
        } else { // Player 'X' (Opponent to 'O')
          if (result.score < bestMove.score) {
            bestMove.score = result.score;
            bestMove.index = spot;
          }
        }
      }
      
      return bestMove;
    }


    // --- ðŸŒ Mode/UI Control Functions ---

    function startGame(selectedMode) {
      // Update UI buttons
      document.querySelectorAll('.btn-group .btn').forEach(btn => btn.classList.remove('active-mode'));
      document.getElementById(`${selectedMode}Btn`).classList.add('active-mode');

      mode = selectedMode;
      
      // Show/Hide difficulty and chat based on mode
      difficultyGroupEl.style.display = mode === 'ai' ? 'block' : 'none';
      chatBoxEl.style.display = mode === 'online' ? 'flex' : 'none';

      resetBoard();

      if (mode === 'online') {
        // Simplified setup for one game room
        const gameRef = ref(db, 'games/game1');
        // Initialize or listen
        set(gameRef, { board: board, currentPlayer: 'X' });

        onValue(gameRef, snapshot => {
          const data = snapshot.val();
          if (data) {
            board = data.board;
            currentPlayer = data.currentPlayer;
            drawBoard();
          }
        });
      }
    }
    
    window.setDifficulty = function(difficulty) {
      currentDifficulty = difficulty;
      // Update UI buttons
      document.querySelectorAll('.difficulty-btn').forEach(btn => btn.classList.remove('active-mode'));
      // Find the button with the correct text and set it active
      document.querySelectorAll('.difficulty-btn').forEach(btn => {
        if (btn.innerText.toLowerCase() === difficulty) {
          btn.classList.add('active-mode');
        }
      });
      // Restart game with new difficulty
      if (mode === 'ai') {
         resetBoard();
      }
    }

    function updateBoard() {
      drawBoard();
      if (mode === 'online') {
        const gameRef = ref(db, 'games/game1');
        set(gameRef, { board: board, currentPlayer });
      }
    }

    window.toggleMusic = function() {
      const muteBtn = document.getElementById('muteBtn');
      if (bgMusic.paused) {
        bgMusic.play();
        muteBtn.innerText = 'Mute';
      } else {
        bgMusic.pause();
        muteBtn.innerText = 'Play Music';
      }
    }

    // --- ðŸš€ Initialization ---

    window.onload = () => {
      // Start in PvP mode by default
      startGame('pvp'); 
      // Initial background music play attempt
      bgMusic.play().catch(() => {
        // Autoplay failed, set button text to reflect paused state
        document.getElementById('muteBtn').innerText = 'Play Music';
      });
    };
  </script>
</body>
</html>
